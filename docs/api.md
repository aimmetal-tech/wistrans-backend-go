# API æ¥å£æ–‡æ¡£

## åŸºç¡€ä¿¡æ¯

- æœåŠ¡å™¨åœ°å€: `http://localhost:8080`
- æ•°æ®æ ¼å¼: JSON
- å­—ç¬¦ç¼–ç : UTF-8

## æ¥å£åˆ—è¡¨

### 1. å¥åº·æ£€æŸ¥æ¥å£

#### æ¥å£è¯´æ˜
æ£€æŸ¥æœåŠ¡è¿è¡ŒçŠ¶æ€

#### æ¥å£åœ°å€
```
GET /health
```

#### è¯·æ±‚å‚æ•°
æ— 

#### å“åº”ç»“æœ
```json
{
  "status": "ok",
  "message": "æœåŠ¡è¿è¡Œæ­£å¸¸"
}
```

### 2. åˆ›å»ºä¼šè¯æ¥å£

#### æ¥å£è¯´æ˜
åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è¯ä¼šè¯

#### æ¥å£åœ°å€
```
GET /conversations
```

#### è¯·æ±‚å‚æ•°
æ— 

#### å“åº”ç»“æœ
```json
{
  "id": "ä¼šè¯ID"
}
```

### 3. è·å–ä¼šè¯è¯¦æƒ…æ¥å£

#### æ¥å£è¯´æ˜
è·å–æŒ‡å®šä¼šè¯çš„è¯¦ç»†ä¿¡æ¯

#### æ¥å£åœ°å€
```
GET /conversations/detail
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| ------ | ------ | ---- | -------- |
| id     | string | æ˜¯   | ä¼šè¯ID   |

#### å“åº”ç»“æœ
```json
{
  "conversation_id": "ä¼šè¯ID",
  "title": "ä¼šè¯æ ‡é¢˜",
  "user_id": "ç”¨æˆ·çš„ID",
  "created_at": "åˆ›å»ºæ—¶é—´",
  "updated_at": "æ›´æ–°æ—¶é—´"
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "äººå·¥æ™ºèƒ½å‘å±•è®¨è®º",
  "user_id": "1234567890",
  "created_at": "2024-01-01T10:00:00Z",
  "updated_at": "2024-01-01T10:05:00Z"
}
```

### 4. è·å–ä¼šè¯å†å²è®°å½•æ¥å£

#### æ¥å£è¯´æ˜
è·å–æŒ‡å®šä¼šè¯çš„æ‰€æœ‰å†å²æ¶ˆæ¯è®°å½•

#### æ¥å£åœ°å€
```
GET /conversations/history
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| ------ | ------ | ---- | -------- |
| id     | string | æ˜¯   | ä¼šè¯ID   |

#### å“åº”ç»“æœ
```json
{
  "conversation_id": "ä¼šè¯ID",
  "messages": [
    {
      "message_id": 1,
      "conversation_id": "ä¼šè¯ID",
      "role": "user",
      "content": "ç”¨æˆ·æ¶ˆæ¯å†…å®¹",
      "created_at": "æ¶ˆæ¯åˆ›å»ºæ—¶é—´"
    },
    {
      "message_id": 2,
      "conversation_id": "ä¼šè¯ID",
      "role": "assistant",
      "content": "åŠ©æ‰‹å›å¤å†…å®¹",
      "created_at": "æ¶ˆæ¯åˆ›å»ºæ—¶é—´"
    }
  ]
}
```

#### å“åº”ç¤ºä¾‹
```json
{
  "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "messages": [
    {
      "message_id": 1,
      "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "role": "user",
      "content": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹äººå·¥æ™ºèƒ½çš„å‘å±•å†ç¨‹",
      "created_at": "2024-01-01T10:00:00Z"
    },
    {
      "message_id": 2,
      "conversation_id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "role": "assistant",
      "content": "äººå·¥æ™ºèƒ½çš„å‘å±•å¯ä»¥åˆ†ä¸ºå‡ ä¸ªé˜¶æ®µ...",
      "created_at": "2024-01-01T10:00:30Z"
    }
  ]
}
```

### 5. æ›´æ–°ä¼šè¯æ¥å£

#### æ¥å£è¯´æ˜
æ›´æ–°ä¼šè¯ä¿¡æ¯ï¼ˆå¦‚æ ‡é¢˜ï¼‰

#### æ¥å£åœ°å€
```
PATCH /conversations/{id}
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜     |
| ------ | ------ | ---- | -------- |
| id     | string | æ˜¯   | ä¼šè¯ID   |

#### è¯·æ±‚ä½“
```json
{
  "title": "ä¼šè¯æ ‡é¢˜"
}
```

#### å“åº”ç»“æœ
```json
{
  "message": "ä¼šè¯æ›´æ–°æˆåŠŸ"
}
```

### 6. æµå¼å¯¹è¯æ¥å£

#### æ¥å£è¯´æ˜
ä¸AIè¿›è¡Œæµå¼å¯¹è¯ï¼Œä½¿ç”¨Server-Sent Events (SSE) è¿”å›ç»“æœ

#### æ¥å£åœ°å€
```
GET /conversations/stream
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜               |
| ------ | ------ | ---- | ------------------ |
| id     | string | æ˜¯   | ä¼šè¯ID             |
| input  | string | æ˜¯   | ç”¨æˆ·è¾“å…¥           |
| model  | string | å¦   | æ¨¡å‹åç§°ï¼Œæ ¼å¼å¦‚openai/gpt-4o |

#### æ¨¡å‹æŒ‡å®šæ–¹å¼

æ”¯æŒä¸¤ç§æ¨¡å‹æŒ‡å®šæ–¹å¼ï¼š

1. ä½¿ç”¨`æœåŠ¡å•†/æ¨¡å‹`æ ¼å¼ï¼š
   - `qwen/qwen-turbo-latest`
   - `deepseek/deepseek-chat`
   - `openai/gpt-4o`
   - `kimi/kimi-k2-0711-preview`

2. ç›´æ¥æŒ‡å®šæ¨¡å‹åç§°ï¼š
   - `qwen-turbo-latest` (è‡ªåŠ¨è¯†åˆ«ä¸ºQwen)
   - `deepseek-chat` (è‡ªåŠ¨è¯†åˆ«ä¸ºDeepSeek)
   - `gpt-4o` (è‡ªåŠ¨è¯†åˆ«ä¸ºOpenAI)
   - `kimi-k2-0711-preview` (è‡ªåŠ¨è¯†åˆ«ä¸ºKimi)

#### å“åº”ç»“æœ
æµå¼å¯¹è¯æ¥å£ä½¿ç”¨ Server-Sent Events (SSE) æ ¼å¼è¿”å›æ•°æ®ï¼ŒåŒ…å«ä¸‰ç§äº‹ä»¶ç±»å‹ï¼š

1. **start** äº‹ä»¶ï¼šæµå¼ä¼ è¾“å¼€å§‹æ ‡è®°

```
event: start
data: {}
```

2. **data** äº‹ä»¶ï¼šå®é™…çš„æ¶ˆæ¯å†…å®¹ï¼Œæ ¼å¼éµå¾ª OpenAI çš„æµå¼å“åº”æ ¼å¼

```
event: data
data: {
  "id": "5a69843e-ca50-4127-8228-927ffbddfdf7",
  "object": "chat.completion.chunk",
  "created": 1747828085,
  "model": "deepseek-chat",
  "choices": [
    {
      "index": 0,
      "delta": {
        "content": "SS"
      },
      "logprobs": null,
      "finish_reason": null
    }
  ]
}
```

å…¶ä¸­ `delta` éƒ¨åˆ†åœ¨ä¸åŒé˜¶æ®µå¯èƒ½åŒ…å«ä¸åŒçš„å†…å®¹ï¼š
å½“ç”Ÿæˆç¬¬ä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œå¯èƒ½åŒ…å« `role` å­—æ®µï¼Œå¦‚ `{"role": "assistant", "content": ""}`
åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œä¸»è¦åŒ…å« `content` å­—æ®µï¼Œå¦‚ `{"content": "å…·ä½“çš„å†…å®¹"}`
åœ¨ç»“æŸæ—¶ï¼Œ`delta` ä¸ºç©ºï¼Œä½†ä¼šåŒ…å« `finish_reason` å­—æ®µï¼Œå¦‚ `{"finish_reason": "stop"}`

3. **end** äº‹ä»¶ï¼šæµå¼ä¼ è¾“ç»“æŸæ ‡è®°

```
event: end
data: {}
```

æ•´ä¸ªæµç¨‹æ˜¯ï¼š
å‘é€ `start` äº‹ä»¶è¡¨ç¤ºå¼€å§‹
å‘é€å¤šä¸ª `data` äº‹ä»¶ï¼Œæ¯ä¸ªäº‹ä»¶åŒ…å«å¢é‡å†…å®¹
æœ€åå‘é€ä¸€ä¸ªå¸¦æœ‰ `finish_reason` çš„ `data` äº‹ä»¶
å‘é€ `end` äº‹ä»¶è¡¨ç¤ºç»“æŸ
è¿™ç§æ ¼å¼ä¸ OpenAI å’Œ DeepSeek çš„æµå¼å“åº”æ ¼å¼å…¼å®¹ã€‚

æ”¯æŒçš„æœåŠ¡å•†å’Œé»˜è®¤æ¨¡å‹ï¼š
- Qwen: `qwen-turbo-latest`
- DeepSeek: `deepseek-chat`
- OpenAI: `gpt-4o`
- Kimi: `kimi-k2-0711-preview`

### 7. ç½‘é¡µç¿»è¯‘æ¥å£

#### æ¥å£è¯´æ˜
ä¸“é—¨ç”¨äºç½‘é¡µå†…å®¹ç¿»è¯‘çš„æ¥å£ï¼Œæ”¯æŒæ‰¹é‡ç¿»è¯‘å¤šä¸ªæ–‡æœ¬ç‰‡æ®µ

#### æ¥å£åœ°å€
```
POST /translate
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å    | ç±»å‹   | å¿…å¡« | è¯´æ˜                           |
| --------- | ------ | ---- | ------------------------------ |
| target    | string | æ˜¯   | ç›®æ ‡è¯­è¨€ï¼Œå¦‚ "en" è¡¨ç¤ºç¿»è¯‘ä¸ºè‹±è¯­ |
| segments  | array  | æ˜¯   | è¦ç¿»è¯‘çš„æ–‡æœ¬ç‰‡æ®µåˆ—è¡¨             |
| extra_args| string | å¦   | ç¿»è¯‘çš„é¢å¤–è¦æ±‚ï¼Œå¦‚é£æ ¼ç­‰         |

#### segmentså‚æ•°è¯´æ˜
| å‚æ•°å | ç±»å‹   | å¿…å¡« | è¯´æ˜                                   |
| ------ | ------ | ---- | -------------------------------------- |
| id     | string | æ˜¯   | ç‰‡æ®µIDï¼Œç”¨äºæ ‡è¯†ç‰‡æ®µä»¥ä¾¿è¿”å›åˆ°å‰ç«¯ç›¸åº”ä½ç½® |
| text   | string | æ˜¯   | è¦ç¿»è¯‘çš„æ–‡æœ¬å†…å®¹                        |

#### è¯·æ±‚ä½“ç¤ºä¾‹
```json
{
  "target": "en",
  "segments": [
    {
      "id": "segment1",
      "text": "è¿™æ˜¯è¦ç¿»è¯‘çš„æ–‡æœ¬"
    },
    {
      "id": "segment2", 
      "text": "è¿™æ˜¯å¦ä¸€æ®µè¦ç¿»è¯‘çš„æ–‡æœ¬"
    }
  ],
  "extra_args": "ç¿»è¯‘é£æ ¼è¦æ±‚ï¼Œå¦‚æ­£å¼ã€å£è¯­åŒ–ç­‰"
}
```

#### å“åº”ç»“æœ
```json
{
  "target": "en",
  "segments": [
    {
      "id": "segment1",
      "text": "This is the text to be translated"
    },
    {
      "id": "segment2",
      "text": "This is another text to be translated"
    }
  ]
}
```

### 8. MCPæœåŠ¡æ¥å£

#### æ¥å£è¯´æ˜
è·å–MCPï¼ˆModel Context Protocolï¼‰æœåŠ¡å™¨é…ç½®ä¿¡æ¯ï¼Œæ”¯æŒå¤šç§MCPæœåŠ¡é›†æˆ

#### æ¥å£åœ°å€
```
POST /mcp
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å     | ç±»å‹     | å¿…å¡« | è¯´æ˜                     |
| --------- | -------- | ---- | ----------------------- |
| model     | string   | æ˜¯   | æ¨¡å‹åç§°                 |
| mcpServers| array    | æ˜¯   | è¯·æ±‚çš„MCPæœåŠ¡å™¨åç§°åˆ—è¡¨   |

#### è¯·æ±‚ä½“ç¤ºä¾‹
```json
{
  "model": "qwen-turbo-latest",
  "mcpServers": ["Fetch"]
}
```

#### æ”¯æŒçš„MCPæœåŠ¡å™¨
ç›®å‰æ”¯æŒçš„MCPæœåŠ¡å™¨åŒ…æ‹¬ï¼š
- **Fetch**: ç½‘é¡µå†…å®¹æŠ“å–æœåŠ¡ï¼Œä½¿ç”¨Dockerè¿è¡Œ `mcp/fetch`

#### å“åº”ç»“æœ
```json
{
  "model": "qwen-turbo-latest",
  "mcpServers": {
    "Fetch": {
      "name": "Fetch",
      "command": "docker", 
      "args": ["run", "-i", "--rm", "mcp/fetch"]
    }
  },
  "timestamp": "2025-08-19T03:52:36.5219341+08:00"
}
```

#### é”™è¯¯å“åº”
å½“è¯·æ±‚ä¸æ”¯æŒçš„MCPæœåŠ¡å™¨æ—¶ï¼š
```json
{
  "error": "ä¸æ”¯æŒçš„MCPæœåŠ¡å™¨: InvalidMCPï¼Œæ”¯æŒçš„æœåŠ¡å™¨: [Fetch]"
}
```

### 9. ç½‘é¡µå†…å®¹æŠ“å–æ¥å£

#### æ¥å£è¯´æ˜
ä½¿ç”¨LLMç»“åˆFetch MCPæœåŠ¡æŠ“å–å’Œåˆ†æç½‘é¡µå†…å®¹ï¼Œæ”¯æŒæ™ºèƒ½æå–ç»“æ„åŒ–ä¿¡æ¯ï¼Œç‰¹åˆ«é€‚ç”¨äºæ–°é—»ã€æ–‡ç« ç­‰å†…å®¹çš„æŠ“å–

#### æ¥å£åœ°å€
```
POST /fetch
```

#### è¯·æ±‚å‚æ•°
| å‚æ•°å        | ç±»å‹     | å¿…å¡« | è¯´æ˜                                    |
| ------------ | -------- | ---- | -------------------------------------- |
| url          | string   | æ˜¯   | è¦æŠ“å–çš„ç½‘é¡µURL                         |
| content_type | string   | å¦   | å†…å®¹ç±»å‹ï¼Œæ”¯æŒ news/article/blogï¼Œé»˜è®¤news |
| extract_fields| array   | å¦   | è¦æå–çš„å­—æ®µåˆ—è¡¨ï¼Œä¸å¡«åˆ™ä½¿ç”¨é»˜è®¤å­—æ®µ       |
| language     | string   | å¦   | å†…å®¹è¯­è¨€ï¼Œæ”¯æŒ zh/en/autoï¼Œé»˜è®¤auto      |
| max_length   | int      | å¦   | æœ€å¤§å†…å®¹é•¿åº¦ï¼Œé»˜è®¤5000                   |

#### å†…å®¹ç±»å‹ä¸é»˜è®¤æå–å­—æ®µ
- **news**: title, content, summary, author, publish_date, category
- **article**: title, content, summary, author, publish_date
- **blog**: title, content, author, publish_date, tags

#### è¯·æ±‚ä½“ç¤ºä¾‹
```json
{
  "url": "https://english.news.cn/",
  "content_type": "news",
  "language": "en",
  "max_length": 5000,
  "extract_fields": ["title", "content", "summary", "author", "category"]
}
```

#### å“åº”ç»“æœ
```json
{
  "url": "https://english.news.cn/",
  "title": "Xinhua â€“ China, World, Business, Sports, Photos and Video",
  "content": "ä¸»è¦å†…å®¹...",
  "summary": "æ–°åç½‘English.news.cnæä¾›ä¸­è‹±æ–‡æ–°é—»å†…å®¹ï¼Œæ¶µç›–ä¸­å›½ã€å›½é™…ã€å•†ä¸šã€ä½“è‚²ç­‰ä¸»é¢˜...",
  "language": "en",
  "status": "success",
  "fetch_time": "2025-08-19T04:01:45Z",
  "extracted_data": {
    "author": "",
    "category": "News", 
    "publish_date": "",
    "tags": ["China", "World", "Business", "Sports", "Culture"]
  }
}
```

#### é”™è¯¯å“åº”
```json
{
  "url": "https://example.com",
  "status": "error",
  "error": "æŠ“å–ç½‘é¡µå¤±è´¥: ç½‘ç»œè¿æ¥è¶…æ—¶",
  "fetch_time": "2025-08-19T04:01:45Z"
}
```

#### ä½¿ç”¨åœºæ™¯
- ğŸ“° æ–°é—»èšåˆå’Œåˆ†æ
- ğŸ“„ å†…å®¹è‡ªåŠ¨æ‘˜è¦
- ğŸ” ç½‘é¡µä¿¡æ¯æå–
- ğŸ“Š åª’ä½“ç›‘æ§
- ğŸŒ å¤šè¯­è¨€å†…å®¹å¤„ç†

#### æŠ€æœ¯ç‰¹ç‚¹
- ğŸ¤– **LLMé©±åŠ¨**: ä½¿ç”¨AIæ¨¡å‹æ™ºèƒ½åˆ†æå†…å®¹
- ğŸ³ **MCPé›†æˆ**: é›†æˆFetch MCPæœåŠ¡è¿›è¡Œå†…å®¹æŠ“å–
- ğŸ“Š **ç»“æ„åŒ–æå–**: è‡ªåŠ¨æå–æ ‡é¢˜ã€æ‘˜è¦ã€ä½œè€…ç­‰ä¿¡æ¯
- ğŸŒ **å¤šè¯­è¨€æ”¯æŒ**: æ”¯æŒä¸­è‹±æ–‡ç­‰å¤šè¯­è¨€å†…å®¹
- ğŸ”§ **çµæ´»é…ç½®**: å¯è‡ªå®šä¹‰æå–å­—æ®µå’Œå†…å®¹ç±»å‹